var map,markers=[],site_num=0,selector_options=[],MapIcon=L.Icon.extend({options:{iconUrl:"/images/map_pin.png",iconSize:[24,32],shadowSize:[24,32],iconAnchor:[11,41],shadowAnchor:[2,31],popupAnchor:[4,-41]}});$(document).ready(function(){$("a[href^=#]").click(function(){var o=$(this).attr("href"),e=!document.uniqueID&&!window.opera&&!window.globalStorage&&window.localStorage;return $(e?"body":"html").animate({scrollTop:$(o).offset().top},400,"swing"),!1}),map=L.mapbox.map("map","georepublic.ghn7n3nf",{scrollWheelZoom:!1}).setView([36.67740687825185,136.71395820379257],6);var o=new MapIcon;$.getJSON("https://spreadsheets.google.com/feeds/list/0AnJGwhMm-ribdEJ6V25HRTV2azVRNkpjTTJSQ3k3Nnc/1/public/values?alt=json").done(function(e){$.each(e.feed.entry,function(e,t){if("launch"==t.gsx$tags.$t&&""!=t.gsx$location.$t){var n=t.gsx$location.$t.split(",");L.marker(n,{icon:o}).addTo(map).bindPopup('<a href="'+t.gsx$sourceurl.$t+'" target="_blank">'+t.gsx$source.$t+"</a>"),selector_options.push({name:t.gsx$source.$t,cd:t.gsx$organizationcode.$t-0,url:t.gsx$webpage.$t}),site_num++}}),$(".js-city-num").text(site_num),_.sortBy(selector_options,"cd").forEach(function(o){$("#js-site-selector").append($("<option />").val(o.url).html(o.name))}),$("#js-site-selector").select2({width:"300px",placeholder:"\u81ea\u6cbb\u4f53\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"})}).fail(function(o,e,t){console.log("fail"),console.log(e),console.log(t)}),$("#js-site-selector-button").on("click",function(o){o.preventDefault();var e=$("#js-site-selector option:selected").val();e&&window.open(e)})});